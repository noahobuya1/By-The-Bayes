---
title: "By the Bayes (STA240 Project)"
author: "Noah Obuya & Tamya Davidson"
date: "2024-05-01"
output: html_document
---

```{r intitializing}

library(tidyverse)

```

# Proposal

## Introduction

Welcome to By the Bayes! A restaurant serving food straight from the Louisiana Bayou. What makes our restaurant special is that every step of our process is backed by probabilistic modeling and inference. It's in our name. Today we'll be taking you through the customer's queuing experience in two different scenarios, providing simulations and explanations to back all of our claims.

## Analysis Plan

#### Scenario One

Our first scenario models simple setting with one dining table and one chef, with operating hours 10am - 10pm. Suppose customers arrive according to a Poisson process with a rate of λA = 5 per hour.

$$
 \lambda_A = 5 \ \text{{per hour}} , \ \text{40 total customers from open to close}
$$

Once a customer arrives, their total service time (ordering, cooking and eating) can be modeled by an exponential distribution with rate λS = 6.

$$
 \lambda_S = 6 
$$

To get a sense of the customer queuing experience, we will run multiple simulations of our exponential distribution. The simulation will model the time it takes to service one customer. Essentially, once one customer comes in, we want to know how long it takes for another customer to be serviced. We only have one table and one chef, so we are only able to handle one customer at a time. We will build upon the exponential distribution simulation to create an algorithm that lets us know whether a not a table is ready for a customer.

To analyze the customer's queueing experience, set the average number of customers in the system = (L), the average number of customers waiting in line = (Lq), the average time a customer spends in the system = (W), and the average time a customer spends waiting in line = (Wq).

(L):represents the average number of customers, including those being served and those waiting in line. In this scenario, we can use the formula for an M/M/1 queue to calculate L: L= λa/ μ−λa

#### Scenario Two

## References

#### Lab 10

Rossetti, R. (2024, April 4). Sakai.duke.edu. <https://sakai.duke.edu/access/content/group/2e691ccc-405a-4982-bf81-42137192402e/Labs/lab10_sol.html>

#### Simulation of Exponential Distribution using R

Hernández, C. (2020, September 29). Simulation of Exponential Distribution using R. RPubs. <https://rpubs.com/carlosehernandezr/Exponential-Distribution#>:\~:text=The%20exponential%20distribution%20can%20be,deviation%20is%20also%201%2Flambda

# Analysis

## Scenario One

#### Part One - The Mean

```{r meanwaittime plot}


lambda_s1 <- 6

x <- seq(0, 1, length.out = 1000)
y <- dexp(x, rate = lambda_s1)

meanwaitingtime <- data.frame(x = x, y = y)

p <- ggplot(meanwaitingtime, aes(x = x, y = y)) +
  geom_line() +
  geom_vline(aes(xintercept = 1/lambda_s1), linetype = "dashed", color = "red") +
  annotate("text", x = 1/lambda_s1, y = max(meanwaitingtime$y)/2, label = "Mean waiting time", hjust = -0.1, color = "red") +
  labs(x = "Waiting time", y = "Density", title = "Exponential distribution with λ = 6")


```

Figure 1 allows us to explain our mean wait time. Given the PDF (Probability Density Function) of our model, we see that the average wait time is 1/6 of an hour, or 10 minutes. This can also be described by $$1/ \lambda$$, once again giving us 1/6 of an hour.

#### Part Two - The Exponential Simulation

```{r}
# Parameters
lambda_A <- 5  # Arrival rate (customers per hour)
lambda_S <- 6  # Service rate (customers per hour)
num_customers <- 1000  # Number of customers to simulate
num_simulations <- 3  # Number of simulations

# Function to run a single simulation and return the average wait time
run_simulation <- function() {
  # Simulate arrival times using Poisson process
  arrival_times <- cumsum(rexp(num_customers, lambda_A))
  
  # Initialize variables
  service_end_time <- 0
  wait_times <- numeric(num_customers)
  
  # Simulate the system
  for (i in 1:num_customers) {
    # Calculate service start time for current customer
    service_start_time <- max(arrival_times[i], service_end_time)
    
    # Calculate service end time for current customer
    service_end_time <- service_start_time + rexp(1, lambda_S)
    
    # Calculate wait time for current customer
    wait_times[i] <- service_start_time - arrival_times[i]
  }
  
  # Return wait times
  return(wait_times)
}

# Run simulations and collect wait times
wait_times_list <- lapply(1:num_simulations, function(x) replicate(num_simulations, run_simulation()))

# Calculate randomized average wait time for each simulation
randomized_avg_wait_times <- lapply(wait_times_list, function(wait_times_matrix) apply(wait_times_matrix, 2, mean))

# Calculate average wait time for each run
average_wait_times <- sapply(randomized_avg_wait_times, mean)

# Output average wait times for each run
cat("Average Wait Times for Each Run:", average_wait_times, "\n")

```

These average wait times represent the typical amount of time a customer spends waiting in line before being served, considering the arrival rate of customers and the service rate of the chef.If the average wait times are consistently high across runs, the restaurant may consider adding more dining tables, hiring additional staff, or optimizing the service process to reduce wait times and improve customer experience. On the other hand, if the average wait times are low and consistent, the restaurant may be efficiently managing customer flow, and no major changes may be necessary.

Sources: <https://saas.studentorg.berkeley.edu/rp/a-shallow-dive-into-time-series-analysis-of-local-restaurant-data-using-r>

<https://web.stanford.edu/class/bios221/labs/simulation/Lab_3_simulation.html>

<https://digitalcommons.library.umaine.edu/cgi/viewcontent.cgi?params=/context/honors/article/1787/&path_info=Everyone_s_a_Waiter_A_Data_Driven_Queuing_Simulation_Model_of_Mike_s_Clam_Shack.pdf>

#### Part Three - The Exponential Simulation with Table Monitoring

## Discussions & Limitations

## Conclusion
